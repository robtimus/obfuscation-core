<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src\site\markdown/examples.md at 2022-03-16
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20220316" />
    <meta http-equiv="Content-Language" content="en" />
    <title>obfuscation-core &#x2013; Examples</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script type="text/javascript" src="./js/apache-maven-fluido-1.7.min.js"></script>
<script type="text/javascript">
  $(document).ready(function () {
    $(".source").addClass("prettyprint");
    prettyPrint();
  });
</script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>obfuscation-core</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2022-03-16<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.4</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">obfuscation-core</li>
    <li><a href="index.html" title="Overview"><span class="none"></span>Overview</a></li>
    <li class="active"><a href="#"><span class="none"></span>Examples</a></li>
    <li><a href="download.html" title="Download"><span class="none"></span>Download</a></li>
    <li><a href="https://github.com/robtimus/obfuscation-core/releases" class="externalLink" title="Releases"><span class="none"></span>Releases</a></li>
    <li><a href="apidocs/index.html" title="JavaDocs"><span class="none"></span>JavaDocs</a></li>
      <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
</ul>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >

<div class="section">
<h2><a name="Obfuscating_all_characters"></a>Obfuscating all characters</h2>

<div>
<div>
<pre class="source">CharSequence obfuscated = Obfuscator.all().obfuscateText(&quot;Hello World&quot;);
// obfuscated represents &quot;***********&quot;
</pre></div></div>

<p>Note: using this obfuscator still leaks out information about the length of the original text. One of the following two is more secure.</p></div>
<div class="section">
<h2><a name="Obfuscating_with_a_fixed_length"></a>Obfuscating with a fixed length</h2>

<div>
<div>
<pre class="source">CharSequence obfuscated = Obfuscator.fixedLength(5).obfuscateText(&quot;Hello World&quot;);
// obfuscated represents &quot;*****&quot;
</pre></div></div>
</div>
<div class="section">
<h2><a name="Obfuscating_with_a_fixed_value"></a>Obfuscating with a fixed value</h2>

<div>
<div>
<pre class="source">CharSequence obfuscated = Obfuscator.fixedValue(&quot;foo&quot;).obfuscateText(&quot;Hello World&quot;);
// obfuscated represents &quot;foo&quot;
</pre></div></div>
</div>
<div class="section">
<h2><a name="Obfuscating_portions_of_text"></a>Obfuscating portions of text</h2>
<p>While the above examples are simple, they are not very flexible. Using <tt>Obfuscator.portion</tt> you can build obfuscators that obfuscate only specific portions of text. Some examples:</p>
<div class="section">
<h3><a name="Obfuscating_all_but_the_last_4_characters"></a>Obfuscating all but the last 4 characters</h3>
<p>Useful for obfuscating values like credit card numbers.</p>

<div>
<div>
<pre class="source">CharSequence obfuscated = Obfuscator.portion()
        .keepAtEnd(4)
        .build()
        .obfuscateText(&quot;1234567890123456&quot;);
// obfuscated represents &quot;************3456&quot;
</pre></div></div>

<p>It&#x2019;s advised to use <tt>atLeastFromStart</tt>, to make sure that values of fewer than 16 characters are still obfuscated properly:</p>

<div>
<div>
<pre class="source">CharSequence obfuscated = Obfuscator.portion()
        .keepAtEnd(4)
        .atLeastFromStart(12)
        .build()
        .obfuscateText(&quot;1234567890&quot;);
// obfuscated represents &quot;**********&quot; and not &quot;******7890&quot;
</pre></div></div>
</div>
<div class="section">
<h3><a name="Obfuscating_only_the_last_2_characters"></a>Obfuscating only the last 2 characters</h3>
<p>Useful for obfuscating values like zip codes, where the first part is not as sensitive as the full zip code:</p>

<div>
<div>
<pre class="source">CharSequence obfuscated = Obfuscator.portion()
        .keepAtStart(Integer.MAX_VALUE)
        .atLeastFromEnd(2)
        .build()
        .obfuscateText(&quot;SW1A 2AA&quot;);
// obfuscated represents &quot;SW1A 2**&quot;
</pre></div></div>

<p>Here, the <tt>keepAtStart</tt> instructs the obfuscator to keep everything; however, <tt>atLeastFromEnd</tt> overrides that partly to ensure that the last two characters are obfuscated regardless of the value specified by <tt>keepAtStart</tt>.</p></div>
<div class="section">
<h3><a name="Using_a_fixed_length"></a>Using a fixed length</h3>
<p>Similar to using <tt>Obfuscator.all</tt>, by default an obfuscator built using <tt>Obfuscator.portion</tt> leaks out the length of the original text. If your text has a variable length, you should consider specifying a fixed total length for the result. The length of the result will then be the same no matter how long the input is:</p>

<div>
<div>
<pre class="source">Obfuscator obfuscator = Obfuscator.portion()
        .keepAtStart(2)
        .keepAtEnd(2)
        .withFixedTotalLength(6)
        .build();
CharSequence obfuscated = obfuscator.obfuscateText(&quot;Hello World&quot;);
// obfuscated represents &quot;He**ld&quot;
obfuscated = obfuscator.obfuscateText(&quot;foo&quot;);
// obfuscated represents &quot;fo**oo&quot;
</pre></div></div>

<p>Note that if <tt>keepAtStart</tt> and <tt>keepAtEnd</tt> are both specified, parts of the input may be repeated in the result if the input&#x2019;s length is less than the combined number of characters to keep. This makes it harder to find the original input. For example, if in the example <tt>foo</tt> would be obfuscated into <tt>fo***o</tt> instead, it would be clear that the input was <tt>foo</tt>. Instead, it can now be anything that starts with <tt>fo</tt> and ends with <tt>oo</tt>.</p></div></div>
<div class="section">
<h2><a name="Using_a_predefined_function"></a>Using a predefined function</h2>
<p>Assuming the current class has a method <tt>CharSequence obfuscate(CharSequence s)</tt>:</p>

<div>
<div>
<pre class="source">Obfuscator obfuscator = Obfuscator.fromFunction(this::obfuscate);
CharSequence obfuscated = obfuscator.obfuscateText(&quot;Hello World&quot;);
// obfuscated is the result of calling obfuscate(&quot;Hello World&quot;)
</pre></div></div>

<p>Note that the input argument needs to be either <tt>CharSequence</tt> or <tt>Object</tt>; the return type of the method may be a sub type of <tt>CharSequence</tt> like <tt>String</tt> or <tt>StringBuilder</tt>.</p>
<p>If the method&#x2019;s input argument is instead <tt>String</tt> you need to use a lambda that calls <tt>toString()</tt> on its argument before passing it to the method:</p>

<div>
<div>
<pre class="source">Obfuscator obfuscator = Obfuscator.fromFunction(s -&gt; obfuscate(s.toString()));
CharSequence obfuscated = obfuscator.obfuscateText(&quot;Hello World&quot;);
// obfuscated is the result of calling obfuscate(&quot;Hello World&quot;.toString())
</pre></div></div>
</div>
<div class="section">
<h2><a name="Obfuscating_objects"></a>Obfuscating objects</h2>

<div>
<div>
<pre class="source">LocalDate date = LocalDate.of(2020, 1, 1);
Obfuscated&lt;LocalDate&gt; obfuscated = Obfuscator.portion()
        .keepAtStart(8)
        .build()
        .obfuscateObject(date);
// obfuscated.toString() returns &quot;2020-01-**&quot;
// the date itself can be retrieved using obfuscated.value()
</pre></div></div>

<p>In this example, the obfuscation will always be the same. That means that the result of obfuscation can be cached, to prevent it from being recalculated every time:</p>

<div>
<div>
<pre class="source">LocalDate date = LocalDate.of(2020, 1, 1);
Obfuscated&lt;LocalDate&gt; obfuscated = Obfuscator.portion()
        .keepAtStart(8)
        .build()
        .obfuscateObject(date)
        .cached();
// obfuscated.toString() returns the same string instance every time it's called
</pre></div></div>
</div>
<div class="section">
<h2><a name="Obfuscating_collections"></a>Obfuscating collections</h2>

<div>
<div>
<pre class="source">List&lt;String&gt; list = new ArrayList&lt;&gt;();
list.add(&quot;hello&quot;);
list.add(&quot;world&quot;);
list = Obfuscator.fixedLength(3).obfuscateList(list);
// list is just like any other List, apart from toString;
// that returns &quot;[***, ***]&quot;

Set&lt;String&gt; set = new HashSet&lt;&gt;();
set.add(&quot;hello&quot;);
set.add(&quot;world&quot;);
set = Obfuscator.fixedLength(3).obfuscateSet(set);
// list is just like any other Set, apart from toString;
// that returns &quot;[***, ***]&quot;

Collection&lt;String&gt; collection = new ArrayList&lt;&gt;();
collection.add(&quot;hello&quot;);
collection.add(&quot;world&quot;);
collection = Obfuscator.fixedLength(3).obfuscateCollection(collection);
// list is just like any other Collection, apart from toString;
// that returns &quot;[***, ***]&quot;
</pre></div></div>
</div>
<div class="section">
<h2><a name="Obfuscating_maps"></a>Obfuscating maps</h2>
<p>To obfuscate each value the same way:</p>

<div>
<div>
<pre class="source">Map&lt;String, String&gt; map = new LinkedHashMap&lt;&gt;();
map.put(&quot;username&quot;, &quot;admin&quot;);
map.put(&quot;password&quot;, &quot;hello&quot;);
map = Obfuscator.fixedLength(3).obfuscateMap(map);
// map is just like any other Map, apart from toString;
// that returns &quot;{username=***, password=***}&quot;
</pre></div></div>

<p>To provide separate obfuscation per entry:</p>

<div>
<div>
<pre class="source">Map&lt;String, String&gt; map = new LinkedHashMap&lt;&gt;();
map.put(&quot;username&quot;, &quot;admin&quot;);
map.put(&quot;password&quot;, &quot;hello&quot;);
map = MapObfuscator.&lt;String, String&gt;builder()
        .withKey(&quot;password&quot;, Obfuscator.fixedLength(3))
        .build()
        .obfuscateMap(map);
// map is just like any other Map, apart from toString;
// that returns &quot;{username=admin, password=***}&quot;
</pre></div></div>
</div>
<div class="section">
<h2><a name="Obfuscating_Properties_objects:"></a>Obfuscating Properties objects:</h2>

<div>
<div>
<pre class="source">Properties properties = new Properties();
properties.put(&quot;username&quot;, &quot;admin&quot;);
properties.put(&quot;password&quot;, &quot;hello&quot;);
properties = PropertiesObfuscator.builder()
        .withProperty(&quot;password&quot;, Obfuscator.fixedLength(3))
        .build()
        .obfuscateProperties(properties);
// properties is just like any other Properties, apart from:
// - toString; that returns &quot;{username=admin, password=***}&quot;
//   or &quot;{password=***, username=admin}&quot;
// - list; that prints &quot;username=admin&quot; and &quot;password=***&quot;
</pre></div></div>
</div>
<div class="section">
<h2><a name="Streaming_obfuscation"></a>Streaming obfuscation</h2>

<div>
<div>
<pre class="source">// assume that writer is an existing Writer
Obfuscator obfuscator = Obfuscator.portion()
        .keepAtStart(24)
        .withFixedTotalLength(27)
        .build();
try (Writer obfuscatingWriter = obfuscator.streamTo(writer)) {
    obfuscatingWriter.write(&quot;username=admin&quot;);
    obfuscatingWriter.write(&quot;&amp;password=hello&quot;);
}
// &quot;username=admin&amp;password=***&quot; has been written to writer
// note that writer has not been closed at this point
</pre></div></div>
</div>
<div class="section">
<h2><a name="Combining_obfuscators"></a>Combining obfuscators</h2>
<p>Sometimes the obfucators in this library alone cannot perform the obfuscation you need. For instance, if you want to obfuscate credit cards, but keep the first and last 4 characters. If the credit cards are all fixed length, <tt>Obfuscator.portion</tt> can do just that:</p>

<div>
<div>
<pre class="source">Obfuscator obfuscator = Obfuscator.portion()
        .keepAtStart(4)
        .keepAtEnd(4)
        .build();
CharSequence obfuscated = obfuscator.obfuscateText(&quot;1234567890123456&quot;);
// obfuscated represents &quot;1234********3456&quot;
</pre></div></div>

<p>However, if you attempt to use such an obfuscator on only a part of a credit card, you could end up leaking parts of the credit card that you wanted to obfuscate:</p>

<div>
<div>
<pre class="source">CharSequence incorrectlyObfuscated = obfuscator.obfuscateText(&quot;12345678901234&quot;);
// incorrectlyObfuscated represents &quot;1234******1234&quot; where &quot;1234********34&quot; would probably be preferred
</pre></div></div>

<p>To overcome this issue, it&#x2019;s possible to combine obfuscators. The form is as follows:</p>
<ul>

<li>Specify the first obfuscator, and the input length to which it should be used.</li>
<li>Specify any other obfuscators, and the input lengths to which they should be used. Note that each input length should be larger than the previous input length.</li>
<li>Specify the obfuscator that will be used for the remainder.</li>
</ul>
<p>For instance, for credit card numbers of exactly 16 characters, the above can also be written like this:</p>

<div>
<div>
<pre class="source">Obfuscator obfuscator = Obfuscator.none().untilLength(4)
        .then(Obfuscator.all()).untilLength(12)
        .then(Obfuscator.none());
</pre></div></div>

<p>With this chaining, it&#x2019;s now possible to keep the first and last 4 characters, but with at least 8 characters in between:</p>

<div>
<div>
<pre class="source">Obfuscator obfuscator = Obfuscator.none().untilLength(4)
        .then(Obfuscator.portion()
                .keepAtEnd(4)
                .atLeastFromStart(8)
                .build());
CharSequence obfuscated = obfuscator.obfuscateText(&quot;12345678901234&quot;);
// obfuscated represents &quot;1234********34&quot;
</pre></div></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2020&#x2013;2022.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
